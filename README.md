# Evanston Heatmap
This is a Ruby script that takes in the precinct-level vote totals from the 2017 Evanston, IL mayoral runoff election and created a color coded map of Evanston based on how they voted.

On a technical level this is different from the standard election result visualizations because it isn't "winner take all" on any level.  I'm sure there was a much easier way to do this, in Tableau or a million other tools, but I wanted to do it this way.  Ruby is my hammer, so this looked like a nail.

The basic breakdown is Hagerty = Blue (rgb(0, 0, 255)) and Tendam = Green (rgb(0, 255, 0)).  Red values are closer to either Green or Blue based on the total vote count relative to the precinct with the highest vote total.  So Cyan means it was an even split, and saturation reflects a higher relative vote total.

I got the precinct map off of the City of Evanston website.  The precinct-level vote totals came from the Cook County Clerk's website.
I loaded the precinct map into Gimp, and created a different layer for each precinct, where the precinct is filled in, but the layer size is equal to the size of the map, so there wouldn't be a problem fitting everything back together again.  I then exported each layer into its own PNG file, and I used these in the script.

Here's how the script works (at least insofar as I actually understand how it works, a lot of it was just trial and error).  I used [RMagick](https://github.com/rmagick/rmagick) (the Ruby version of Image Magick) for all of the image processing.  I loaded the precinct images into an image list, and did a few things so it could find the colored section (I assume there was an easier way to do it, but for as great as the documentation and community Q&A is around Image Magick (and it's fantastic), there was a lot of stuff that really just didn't make sense to me.

So the calculation of the color was pretty straightforward.  I used the RGB Colorspace, Blue and Green were both (255 * (Candidate Precinct Vote Count / Precinct Total)).  Red was a little trickier - it used the greater of the two other values as its reference point, (Blue or Green - (Blue or Green * (Precinct Total / Largest Precinct Total in Evanston))), and then divided it by 5.  The first time through it wasn't divided by 5, and it looked like garbage, choosing 5 was toally arbitrary.  

It identified the precinct area using the image's colormap, and replaced it with the new image.  I had it change the class type to Direct Class because I wanted to export it as a PNG or JPG/JPEG, and it ignored the colormap so long as the image's class type was Pseudo Class (I really have no idea what any of that means, but I know that's why it kept spitting out images where the colors weren't changed).  Then I flattened the image list and got the image.

The main script is heatmap.rb.  The other script is just an earlier version of the method, which I used while tinkering around in the Ruby console.  The final image is mayoral_heatmap.jpeg.

# Why I Did This
Evanston does not usually have close elections, at least not in citywide or large elections.  It's like 95% Democrat (might be an exaggeration, but if so, not by much), and so long as I've been old enough to know what a mayor is we've had a grand total of 2 mayors, both of whom made a habit of winning in by landslides.  The Democratic primaries have some variance, but in every congressional, senate, gubernatorial, and state legislative race everyone votes for the Democrat.  Even in 2010, when Mark Kirk won statewide (in a pretty blue state) he got something like 30% of the vote in Evanston (I don't remember what it actually was, that could be way off, but I remember distinctly there was at least 1 precinct where the Green Party candidate got more votes than Kirk did).  

The thing is, Evanston is a pretty diverse city in a lot of ways - racially, economically, religiously, etc.  While pretty much everyone is either a Democrat or a Democrat-leaning independent, those are very broad categories and it sure seems like Evanstonians (and Northwestern students, who don't count but are allowed to vote because of democracy or something) take a lot of roads to the same destination.  

On this most recent Tuesday (4/4/2017) we had a mayoral runoff election.  I just assumed Hagerty was going to win in a landslide, because that's what we do here and he won something like 44% of the vote in the primary back in February.  Nope, whatever Tendam did, it worked (well, almost worked, depending on how you look at it), and as of right now the race still hasn't been decided.  The total once all of the votes available were counted on Tuesday had Hagerty leading by only 168 votes, with close to 1,000 outstanding mail-in ballots (hard to say how many of those are actually on their way).  There was 35.74% turnout, which seems exceptionally large for a municipal election in a city where our local affairs get very little media attention, as the Chicago media market is dominant here.

That's when I got excited.  I have a preference on who wins, but really they both seem alright to me - what's really interesting is this presented an opportunity we haven't really had before, to see some of the diversity in our voting behavior.  Local elections are weird, so I don't really have much of a theory on why each neighborhood voted the way that it did, namely because both candidates seemed to draw support from a pretty diverse cast across all of the traditional lines of identity differentiation.  

This doesn't explain why different sections of Evanston voted the way they did, but it does shed some light on how the different areas of Evanston voted.  It's just a visualization, there isn't any value-added in terms of the actual data, but unless you're a weirdo who knows all of our Wards and Precincts by heart, it's pretty tricky to keep jumping between the data and the map to see where the precinct is in Evanston while also remembering where the last one (or 5) you looked at are as well.  What I was looking to address with this.

